<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE10;IE=EmulateIE9">
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="edge"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="shortcut icon" href="/style/images/index/favicon.png"/>
    <link rel="stylesheet" type="text/css" href="../js/lib/easyui1.4.4/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../js/lib/easyui1.4.4/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../style/wb.css">
    <link rel="stylesheet" type="text/css" href="../style/main.css"/>
    <script type="text/javascript" src="../js/loader.js"></script>
    <script type="text/javascript" charset="utf-8" src="../ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="../ueditor/ueditor.all.min.js"></script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="../ueditor/lang/zh-cn/zh-cn.js"></script>
    <!--<script type="text/javascript" charset="utf-8" src="../ueditor/third-party/jquery-1.10.2.min.js"></script>-->
    <script src="../js/lib/store.js" charset="utf-8"></script>
</head>
<body class="easyui-layout" data-options="fit:true,border:false">
<div data-options="region:'center',border:false" class="editBox" title="">
    <div id="ben" style="line-height:40px">
        <span class="datagrid-btn-separator"></span>
        <a href="javascript:void(0);" class="easyui-linkbutton" data-options="iconCls:'icon-save'"
           onclick="submitFrom()">提交案例</a>
        <span class="datagrid-btn-separator"></span>
    </div>
    <form id="form" method="post">
        <input id="mid" name="mid" type="hidden"/>
        <table class="grid">
            <tr>
                <td align="center">文档名称</td>
                <td style="padding: 10px 10px;">
                    <input id="docId" name="docId" style="width: 260px; height:28px;"
                           data-options="required:true"/>
                    <a class="easyui-linkbutton fr" href="javascript:void(0)"
                       onclick="$('#docId').combobox('clear');">
                        清空
                    </a>
                </td>
            </tr>
            <tr>
                <td align="center">案例标题</td>
                <td style="padding: 10px 10px;">
                    <input name="title" id="title" class="easyui-textbox"
                           data-options="width:800,required:true,prompt:'请输入标题名称'" style="height:28px">
                </td>
            </tr>
            <tr>
                <td align="center">摘&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;要</td>
                <td style="padding: 10px 10px;">
                    <textarea name="abstracts" id="abstracts" class="textarea easyui-validatebox"
                              style="height:60px;width:800px " data-options="required:true,prompt:'请输入主要摘要'"></textarea>
                </td>
            </tr>
            <tr>
                <td align="center">推送通知</td>
                <td style="padding: 10px 10px;">
                    <span class="radioSpan">
                        <input type="radio" name="isMessage" checked value="true">推送</input>
                        <input type="radio" name="isMessage" value="false">不推送</input>
                        </span>
                </td>
            </tr>
            <tr>
                <td align="center">内&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;容</td>
                <td style="padding: 10px 10px;">
                    <input type='hidden' name='content' id='content'/>
                    <script id='editor' type='text/plain' style='width:790px;height:500px;'></script>
                </td>
            </tr>
        </table>
    </form>
    <!-- <input type="button" value="提交" onclick="submitFrom()" style="margin-left: 100px;width:75px;height: 30px;display: inline-block">-->
</div>
<script type="text/javascript">
    var url = '';
    var data = null;
    loader.load('common', function () {
        data = parent.window.datas;
        var pcate = "";
        /* debugger;*/
        UE.getEditor('editor', {
            autoHeightEnabled: false,
            autoFloatEnabled: false
        });
        if (data) {
            url = 'edit';
            $("#title").val(data.title);
            $("#abstracts").val(data.abstracts);
            $("#content").val(data.content);
            $("#docId").val(data.docId);
            $("#mid").removeAttr("disabled");
            $("#mid").val(data.mid);
            parent.window.datas = null;
            UE.getEditor('editor').addListener("ready", function () {
                UE.getEditor('editor').execCommand("inserthtml", data.content, true);
            });
        } else {
            url = 'add';
            $("#mid").attr("disabled", "disabled");
        }

        $(function () {
            $('#form').form({
                onSubmit: function () {
                    progressLoad();
                    var isValid = $(this).form('validate');
                    if (!isValid) {
                        progressClose();
                    }
                    return isValid;
                },
                success: function (result) {
                    progressClose();
                    result = $.parseJSON(result);
                    if (result.success) {
                        parent.window.refresh();
                        parent.window.closeTab();
                        /*   window.opener.location.href =window.closeTab();
                         window.close();*/
                        $.messager.alert('提示', result.msg, 'info');
                        delete parent.window.refresh;
                    } else {
                        $.messager.alert('错误', result.msg, 'error');
                    }
                }
            });
            $.ajax({
                type: "get",
                url: store.get("context") + "/doc/dataAll",
                dataType: "json",
                cache: false,
                success: function (result) {
                    $("#docId").combobox({
                        data: result.rows,
                        valueField: 'mid',
                        textField: 'title',
                        onChange: function (newValue) {
                        }
                    });
                }
            });
            UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl;
            UE.Editor.prototype.getActionUrl = function (action) {
                if (action == 'uploadimage') {
                    return store.get("context") + '/ueditor/upload/image';
                } else if (action == 'uploadvideo') {
                    return store.get("context") + '/ueditor/upload/video';
                } else if (action == 'uploadfile') {
                    return store.get("context") + '/ueditor/upload/file';
                } else if (action == 'listimage') {
                    return store.get("context") + '/ueditor/list/image';
                } else if (action == 'listfile') {
                    return store.get("context") + '/ueditor/list/file';
                } else {
                    return this._bkGetActionUrl.call(this, action);
                }
            }
        });
    });


    function submitFrom() {
        var context = UE.getEditor('editor').getContent();
        /* var context= UE.getEditor('editor').getContentTxt();*/
        $("#content").val(context);

        $("#form").form({
            url: url
        });
        $("#form").submit();

    }

</script>
</body>
</html>